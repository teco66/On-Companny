<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Finalizar Pedido ‚Ä¢ On Company</title>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:linear-gradient(180deg,#fdf9f4,#f5efe8);
  color:#333;
}
.container{
  max-width:720px;
  margin:40px auto;
  background:#fff;
  border-radius:18px;
  padding:24px;
  box-shadow:0 10px 25px rgba(0,0,0,.08);
}
h1{
  margin-top:0;
  text-align:center;
}
.section{
  margin-bottom:28px;
}
.section h2{
  font-size:18px;
  margin-bottom:12px;
}
.resumo{
  background:#faf7f2;
  padding:16px;
  border-radius:12px;
  font-size:14px;
}
.resumo ul{
  padding-left:18px;
  margin:8px 0;
}
.resumo strong{
  display:block;
  margin-top:6px;
}
label{
  display:block;
  font-size:14px;
  margin-bottom:6px;
}
input, textarea{
  width:100%;
  padding:10px;
  border-radius:10px;
  border:1px solid #ccc;
  font-size:14px;
}
textarea{resize:none}
input[type="file"]{
  padding:6px;
}
button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:14px;
  background:#cbb69c;
  color:#fff;
  font-size:16px;
  cursor:pointer;
}
button:disabled{
  background:#aaa;
  cursor:not-allowed;
}
.footer{
  text-align:center;
  font-size:13px;
  color:#666;
  margin-top:14px;
}
</style>
</head>

<body>

<div class="container">

<h1>Finalize seu pedido</h1>

<!-- üì¶ RESUMO DO PEDIDO -->
<div class="section">
  <h2>üì¶ Resumo do pedido</h2>
  <div class="resumo" id="resumoPedido">
    Carregando pedido...
  </div>
</div>

<!-- üë§ DADOS DO CLIENTE -->
<div class="section">
  <h2>üë§ Dados do cliente</h2>

  <label>Nome completo *</label>
  <input type="text" id="nome" required>

  <label>WhatsApp *</label>
  <input type="tel" id="whatsapp" required placeholder="Ex: 9XXXXXXXX">

  <label>Cidade / Prov√≠ncia *</label>
  <input type="text" id="cidade" required>
</div>

<!-- üí≥ COMPROVANTE -->
<div class="section">
  <h2>üí≥ Comprovante de pagamento</h2>

  <label>Anexar comprovante *</label>
  <input type="file" id="comprovante" accept=".jpg,.jpeg,.png,.pdf" required>
</div>

<!-- üìù OBS -->
<div class="section">
  <h2>üìù Observa√ß√µes (opcional)</h2>
  <textarea id="obs" rows="3"></textarea>
</div>

<button id="enviarBtn">Enviar pedido</button>

<div class="footer">
  Ao enviar, voc√™ confirma que as informa√ß√µes est√£o corretas.
</div>

</div>

<script>
/* ===============================
   üîπ CARREGAR RESUMO DO CARRINHO
   =============================== */

const resumoDiv = document.getElementById("resumoPedido");

// ‚ö†Ô∏è ajuste se seu carrinho estiver em outro formato
const cart = JSON.parse(localStorage.getItem("cart")) || {};

if (!Object.keys(cart).length) {
  resumoDiv.innerHTML = "Nenhum produto encontrado no carrinho.";
} else {
  let subtotal = 0;
  let html = "<ul>";

  Object.values(cart).forEach(i => {
    subtotal += i.price * i.qty;
    html += `<li>${i.name} (${i.qty}x)</li>`;
  });

  const rate = subtotal >= 150000 ? 0.10 : 0.15;
  const total = subtotal * (1 + rate);

  html += "</ul>";
  html += `<strong>Subtotal: ${subtotal.toLocaleString("pt-BR")} Kz</strong>`;
  html += `<strong>Total: ${total.toLocaleString("pt-BR")} Kz</strong>`;

  resumoDiv.innerHTML = html;
}

/* ===============================
   üîπ ENVIO DO PEDIDO
   =============================== */

document.getElementById("enviarBtn").onclick = async () => {

  const nome = document.getElementById("nome").value.trim();
  const whatsapp = document.getElementById("whatsapp").value.trim();
  const cidade = document.getElementById("cidade").value.trim();
  const obs = document.getElementById("obs").value.trim();
  const fileInput = document.getElementById("comprovante");

  if (!nome || !whatsapp || !cidade || !fileInput.files.length) {
    alert("Preencha todos os campos obrigat√≥rios.");
    return;
  }

  const formData = new FormData();
  formData.append("nome", nome);
  formData.append("whatsapp", whatsapp);
  formData.append("cidade", cidade);
  formData.append("obs", obs);
  formData.append("comprovante", fileInput.files[0]);

  formData.append("pedido", JSON.stringify(cart));

  // üî• AQUI VAI O ENDPOINT DO APPS SCRIPT (vamos colocar depois)
  await fetch("URL_DO_APPS_SCRIPT_AQUI", {
    method: "POST",
    body: formData
  });

  // LIMPA CARRINHO
  localStorage.removeItem("cart");

  // REDIRECIONA PARA P√ÅGINA DE SUCESSO
  window.location.href = "sucesso.html";
};
</script>

</body>
</html>

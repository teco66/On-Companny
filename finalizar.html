<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Finalizar Pedido ‚Ä¢ On Company</title>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:linear-gradient(180deg,#fdf9f4,#f5efe8);
  color:#333;
}
.container{
  max-width:760px;
  margin:40px auto;
  background:#fff;
  border-radius:18px;
  padding:24px;
  box-shadow:0 10px 25px rgba(0,0,0,.08);
}
h1{text-align:center;margin-top:0}
.section{margin-bottom:30px}
.section h2{font-size:18px;margin-bottom:12px}

.resumo{
  background:#faf7f2;
  padding:16px;
  border-radius:12px;
  font-size:14px;
}

.pagamento{
  background:#f0f7f4;
  border:1px solid #cfe7dd;
  padding:16px;
  border-radius:12px;
  font-size:14px;
}
.pagamento .linha{
  display:flex;
  justify-content:space-between;
  gap:10px;
  margin:6px 0;
  align-items:center;
}
.pagamento code{
  background:#fff;
  padding:6px 8px;
  border-radius:6px;
  font-size:13px;
}
.copy-btn{
  padding:6px 10px;
  border:none;
  border-radius:8px;
  background:#cbb69c;
  color:#fff;
  cursor:pointer;
  font-size:12px;
}
.copy-btn.copiado{background:#4caf50}

label{display:block;font-size:14px;margin-bottom:6px}
input{
  width:100%;
  padding:10px;
  border-radius:10px;
  border:1px solid #ccc;
  font-size:14px;
}
input[type="file"]{padding:6px}

button.enviar,
button.voltar{
  width:100%;
  padding:14px;
  border:none;
  border-radius:14px;
  background:#cbb69c;
  color:#fff;
  font-size:16px;
  cursor:pointer;
}
button.enviar:disabled{
  background:#aaa;
  cursor:not-allowed;
}
button.voltar{
  margin-top:10px;
  font-size:14px;
}

.footer{
  text-align:center;
  font-size:13px;
  color:#666;
  margin-top:14px;
}
</style>
</head>

<body>

<div class="container">

<h1>Finalize seu pedido</h1>

<div class="section">
  <h2>üì¶ Resumo do pedido</h2>
  <div class="resumo" id="resumoPedido">Carregando...</div>
</div>

<div class="section">
  <h2>üí≥ Dados para pagamento</h2>
  <div class="pagamento">
    <strong>Angola ‚Äì Transfer√™ncia Banc√°ria</strong>

    <div class="linha"><span>B.F.A ‚Äì IBAN</span><code id="iban1">000600002246601030178</code><button class="copy-btn" onclick="copiar('iban1',this)">Copiar</button></div>
    <div class="linha"><span>B.A.I ‚Äì IBAN</span><code id="iban2">004000000242539210149</code><button class="copy-btn" onclick="copiar('iban2',this)">Copiar</button></div>
    <div class="linha"><span>BIC ‚Äì IBAN</span><code id="iban3">005100005439922710131</code><button class="copy-btn" onclick="copiar('iban3',this)">Copiar</button></div>
    <div class="linha"><span>Millennium ‚Äì IBAN</span><code id="iban4">005500001693032510136</code><button class="copy-btn" onclick="copiar('iban4',this)">Copiar</button></div>
    <div class="linha"><span>Banco Sol ‚Äì IBAN</span><code id="iban5">004400009979788510185</code><button class="copy-btn" onclick="copiar('iban5',this)">Copiar</button></div>

    <hr style="margin:14px 0">

    <strong>Brasil ‚Äì PIX</strong>
    <div class="linha"><span>Chave PIX</span><code id="pix">43604725000100</code><button class="copy-btn" onclick="copiar('pix',this)">Copiar</button></div>
  </div>
</div>

<div class="section">
  <h2>üë§ Dados do cliente</h2>
  <label>Nome completo *</label><input id="nome">
  <label>WhatsApp *</label><input id="whatsapp">
  <label>Cidade / Prov√≠ncia *</label><input id="cidade">
</div>

<div class="section">
  <h2>üìé Comprovante de pagamento *</h2>
  <div style="position:relative">
    <input type="file" id="comprovante" accept=".jpg,.jpeg,.png,.pdf">
    <button type="button" id="removeFile"
      style="display:none;position:absolute;right:10px;top:8px;
      border:none;background:#ff4d4d;color:#fff;border-radius:50%;
      width:22px;height:22px;cursor:pointer">√ó</button>
  </div>
</div>

<button class="enviar" id="btnEnviar" disabled>Enviar pedido</button>
<button class="voltar" onclick="window.location.href='index.html'">‚Üê Voltar ao cat√°logo</button>

<div class="footer">O envio s√≥ √© liberado ap√≥s anexar o comprovante.</div>
</div>

<script>
const resumoDiv=document.getElementById("resumoPedido");
let cart={};

try{cart=JSON.parse(localStorage.getItem("cart"))||{}}catch{}

if(!Object.keys(cart).length){
  resumoDiv.innerHTML="Nenhum produto encontrado no carrinho.";
}else{
  let subtotal=0;
  let html="<ul>";
  Object.values(cart).forEach(i=>{
    subtotal+=i.price*i.qty;
    html+=`<li>${i.name} (${i.qty}x)</li>`;
  });
  const rate=subtotal>=150000?0.10:0.15;
  const tax=subtotal*rate;
  const total=subtotal+tax;
  html+="</ul>";
  html+=`<p><strong>Subtotal:</strong> ${subtotal.toLocaleString("pt-BR")} Kz</p>`;
  html+=`<p><strong>Taxa (${rate*100}%):</strong> ${tax.toLocaleString("pt-BR")} Kz</p>`;
  html+=`<p><strong>Total a pagar:</strong> ${total.toLocaleString("pt-BR")} Kz</p>`;
  resumoDiv.innerHTML=html;
}

function copiar(id,btn){
  navigator.clipboard.writeText(document.getElementById(id).innerText);
  btn.innerText="Copiado ‚úì";
  setTimeout(()=>btn.innerText="Copiar",1500);
}

const fileInput=document.getElementById("comprovante");
const removeBtn=document.getElementById("removeFile");
const btnEnviar=document.getElementById("btnEnviar");

function validar(){
  btnEnviar.disabled=!(
    nome.value.trim() &&
    whatsapp.value.trim() &&
    cidade.value.trim() &&
    fileInput.files.length
  );
}

["nome","whatsapp","cidade"].forEach(id=>{
  document.getElementById(id).addEventListener("input",validar);
});

fileInput.onchange=()=>{
  if(fileInput.files.length) removeBtn.style.display="block";
  validar();
};

removeBtn.onclick=()=>{
  fileInput.value="";
  removeBtn.style.display="none";
  btnEnviar.disabled=true;
};

btnEnviar.onclick=()=>{
  let subtotal=0;
  const itens=Object.values(cart).map(i=>{
    subtotal+=i.price*i.qty;
    return `${i.id}:${i.qty}`;
  }).join(" | ");

  const file=fileInput.files[0];
  const reader=new FileReader();

  reader.onload=()=>{
    const payload={
      nome:nome.value.trim(),
      whatsapp:whatsapp.value.trim(),
      cidade:cidade.value.trim(),
      itens,
      subtotal,
      file:reader.result.split(",")[1],
      fileName:file.name,
      fileType:file.type
    };

    fetch("https://script.google.com/macros/s/AKfycbxGJfcKC4iDEDMJXWo0nhqMsAQB7NhI4ivlZ_9a8FNvJa-KbsGlX5152bTionZfOCA/exec",{
      method:"POST",
      body:new URLSearchParams({data:JSON.stringify(payload)})
    }).catch(()=>{});

    localStorage.removeItem("cart");
    window.location.href="sucesso.html";
  };

  reader.readAsDataURL(file);
};
</script>

</body>
</html>





